library(rvest)
library(dplyr)

link <- "https://finance.yahoo.com/quote/AMGN?p=AMGN&.tsrc=fin-srch"

page <- read_html(link)
xpath <- "/html/body/div[1]/div/div/div[1]/div/div[3]/div[1]/div/div[1]/div/div/div/div[2]/div[2]/table"

h1 <- page %>%
  html_node("h1") %>%
  html_text() 

table2 <- page %>%
  html_node(xpath = xpath) %>%
  html_table()

results <- data.frame(stock = h1, market_cap = table2$X2[1])
print(results)
"ABVX",
"BCART",
"UCB",
# worked - "RCKT",
"ULTI",
# worked - "IVVD",
"ALMDT"
"REDX",
"DMT",
"ABSCI"
"BAVA"
"FHTC"
"HNSA"

results_table <- setNames(data.frame(matrix(ncol = 2, nrow = 0)), c("stock", "market_cap"))
stock_symbols <- c("ME",
                   "AMGN",
                   "AADI",
                   "TXG",
                   "ABCL",
                  
                   "ARAY",
                   "ADPT",
                   "AGIO",
                   "ALLK",
                   "ALLO",
                   "ATEC",
                   "FOLD",
                   "ANAB",
                   "ANNX",
                   "ARDX",
                   "ARGX",
                   "AZN",
                   "ATAI",
                   "AZYO",
                   "BDX",
                   "BGNE",
                   "BTTX",
                   "TECH",
                   
                   "BIIB",
                   "BNGO",
                   "BDTX",
                   "BPMC",
                   "BRKR",
                   "CANO",
                   "IPSC",
                   "CERE",
                   "CI",
                   "CMPS",
                   "CRSP",
                   "CGEM",
                   "DRIO",
                   "DCPH",
                   "EDIT",
                   "ELAN",
                   "LLY",
                   "EXAS",
                   "XGN",
                   "EYPT",
                   "GBIO",
                   "GHRS",
                   "DNA",
                   "GRTS",
                   "HUMA",
                   "IMCR",
                   "INCY",
                   "NTLA",
                   "NVTA",
                   
                   "IOBT",
                   "IRWD")
stock_symbols3 <- c(                   
                   "KYMR",
                   "MDGL",
                   "MRNS",
                   "MDXH",
                   "MDT",
                   "MRTX",
                   "MRNA",
                   "MORF",
                   "NAUT",
                   "NVS",
                   "OSCR",
                   "OVID",
                   "PKI",
                   "PRAX",
                   "PRME",
                   "REGN",
                   "RVNC",
                   "RYTM",
                   
                   "SGMO",
                   "SGMO",
                   "SAGE",
                   "MCRB",
                   "STTK",
                   "STXS",
                   "STOK",
                   "SURF")
                   
                   
stock_symbols2 <- c("SNDX",
                   "TAK",
                   "TNDM",
                   "TDOC",
                   "TBIO",
                   "TNYA",
                   "TMO",
                   "TMDX",
                   
stock_symbols4 <- c(                   
                   
                   
                   "IVVD",
                   "QURE",
                   "VERA",
                   "VRCA",
                   "VYGR",
                   "WAT",
                   "XLO",
                   "ZTS",
                   "TSVT",
                   "ABBV",
                   "ADCT",
                   "AKYA",
                   "ALEC",
                   "ALPN",
                   "AMAM",
                   "AMWL",
                   "ANTX",
                   "ABUS",
                   "ARQT",
                   "BECL",
                   "AUPH",
                   "AVTR",
                   "RNA",
                   "RCEL",
                   "AVRO",
                   "AZTA",
                   "BCYC",
                   "BDSX",
                   "BHVN",
                   "BLFS",
                   "BOLT",
                   "BMY",
                   "BFLY",
                   "CABA",
                   "CRDF",
                   "CMRX",
                   "CDXS",
                   "CHRS",
                   "CUE",
                   "CTMX",
                   "CTSO",
                   "DAWN",
                   "DNLI",
                   "DICE",
                   "DCGO",
                   "EW",
                   "ELEV",
                   "ESTA",
                   "EVLO",
                   "EVH",
                   "EVT",
                   "EXEL",
                   "EXAI",
                   "FUSN",
                   "GTHX",
                   "WGS",
                   "GILD",
                   "GDRX",
                   "HRTX",
                   "HOLX",
                   "HUM",
                   "ICVX",
                   "IKNA",
                   "ILMN",
                   "IMRX",
                   "INAB",
                   "ICPT",
                   "IVA",
                   "IONS",
                   "IOVA",
                   "ITOS",
                   "ISEE",
                   "JAZZ",
                   "JNJ",
                   "KZR",
                   "KRON",
                   "KRYS",
                   "LEGN",
                   "MGNX",
                   "MXCT")

stock_symbols5 <- c(
                   
                   "MIST",
                   "MTEM",
                   "GLUE",
                   "MLTX",
                   "MYGN",
                   "NSTG",
                   "NKTR",
                   "NGM",
                   "NCNA",
                   "NVDA",
                   "OCUL",
                   "OLMA",
                   "ORTX",
                   "OWLT",
                   "PACB",
                   "PASG",
                   "PSNL",
                   "PFE",
                   "PNT",
                   "PRCT",
                   "PROK",
                   "PTCT",
                   "PBYI",
                   "QTRX",
                   "QSI",
                   "RCM",
                   "RDNT",
stock_symbols6 <- c(                   
                   "ROIV",
                   "RPRX",
                   "SNY",
                   "SRRK",
                   "OMIC",
                   "SOPH",
stock_symbols6 <- c(                   
                   "SPRO",
                   "SWTX",
                   "SUPN",
                   "SYRS",
                   "TOI",
                   "TWST",
                   "TYRA",
                   "RARE",
                   "UTHR",
                   "UBX",
                   "URGN",
                   "VALN",
                   "VCYT",
                   "VRTX",
                   "VIR",
                   "VYNE",
                   "XOMA",
                   "ME",
                   "MASS",
                   "AADI",
stock_symbols6 <- c( 
                   "ACHC",
                   "ADAP",
                   "ADVM",
                   "AVTE",
                   "AGL",
                   "AKLI",
                   "ALNY",
                   "AMRN",
                   "AMGN",
                   "APLS",
                   "APLT",
                   "ARWR",
                   "ATRA",
                   "AURA",
                   "AXSM",
                   stock_symbols6 <- c(
                   "BEAM",
                   "BLU",
                   "BCRX",
                   "BMRN",
                   "BBIO",
                   "CELC",
                   "CERS",
                   "CFMS",
                   "CTIC",
                   "CTKB",
                   "DMTK",
                   "DVAX",
                   "EWTX",
                   "TRDA",
                   "NVNO",
                   "ESPR",
                   "FATE",
                   stock_symbols6 <- c(
                   "FGEN",
                   "FREQ",
                   "GLYC",
                   "GH",
                   stock_symbols6 <- c( 
                   "HCA",
                   "FIXX",
                   "IMGN",
                   "IMPL",
                   "INZY",
                   "INSM",
                   "PODD",
                   "KROS",
                   "MDWD",
                   "MRSN",
                   "MNMD",
                   "MOLN",
                   "NTRA",
                   "NAMS",
                   "NKTX",
                   "NVAX",
                   "NVO",
                   "NUVL",
                   "NUVA",
                   "OABI",
                   "OM",
                   "PLRX",
                   "PMVP",
                   "PROF",
                   "TARA",
                   "RLYB",
                   "RPID",
                   "RLAY",
                   "RPTX",
                   "RVMD",
                   "RHHBY",
                   "SANA",
                   "SCPH",
                   "SEER",
                   "SERA",
                   "LAB",
                   "STRO",
                   "SNDX",
                   "TNGX",
                   "TKNO",
                   "TERN",
                   "TBPH",
                   "TCRX",
                   "RBOT",
                   "VRDN",
                   "VTGN",
                   "XNCR",
                   "ZYNE")

for(x in stock_symbols6) {
  
  link <- paste("https://finance.yahoo.com/quote/", x, "?p=", x, "&.tsrc=fin-srch",  sep = "")
  print(x)
  page <- read_html(link)
  xpath <- "/html/body/div[1]/div/div/div[1]/div/div[3]/div[1]/div/div[1]/div/div/div/div[2]/div[2]/table"
  
  heading1 <- page %>%
    html_node("h1") %>%
    html_text()
  
  table_markcap <- page %>%
    html_node(xpath = xpath) %>%
    html_table() 
  
  loop_result <- data.frame(stock = heading1,
                              market_cap = table_markcap$X2[1])
  
  results_table <- rbind(results_table, loop_result)
}
